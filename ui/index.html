<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>FloatSort - V2</title>
    <link rel="stylesheet" href="styles_minimal.css">
</head>
<body>
    <!-- SVG图标库 -->
    <svg style="display: none;">
        <symbol id="icon-folder" viewBox="0 0 24 24">
            <path fill="currentColor" d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>
        </symbol>
        <symbol id="icon-doc" viewBox="0 0 24 24">
            <path fill="currentColor" d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
        </symbol>
        <symbol id="icon-activity" viewBox="0 0 24 24">
            <path fill="currentColor" d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
        </symbol>
        <symbol id="icon-minimize" viewBox="0 0 24 24">
            <path fill="currentColor" d="M19 13H5v-2h14v2z"/>
        </symbol>
        <symbol id="icon-close" viewBox="0 0 24 24">
            <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </symbol>
        <symbol id="icon-check" viewBox="0 0 24 24">
            <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
        </symbol>
        <symbol id="icon-error" viewBox="0 0 24 24">
            <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </symbol>
        <symbol id="icon-up" viewBox="0 0 24 24">
            <path fill="currentColor" d="M7 14l5-5 5 5z"/>
        </symbol>
        <symbol id="icon-down" viewBox="0 0 24 24">
            <path fill="currentColor" d="M7 10l5 5 5-5z"/>
        </symbol>
        <symbol id="icon-settings" viewBox="0 0 24 24">
            <path fill="currentColor" d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
        </symbol>
    </svg>
    
    <!-- 完整界面 -->
    <div class="app-container" id="appContainer">
        <!-- 顶部标题栏 -->
        <header class="app-header" data-tauri-drag-region>
            <div class="logo">
                <svg class="logo-icon" width="24" height="24"><use href="#icon-folder"/></svg>
                <h1>FloatSort <span style="font-size: 10px; color: #999;">v2.1</span></h1>
            </div>
            <div class="header-actions">
                <button class="icon-btn" id="minimizeBtn" title="最小化到托盘">
                    <svg width="16" height="16"><use href="#icon-minimize"/></svg>
                </button>
                <button class="icon-btn close-btn" id="closeWindowBtn" title="退出程序">
                    <svg width="16" height="16"><use href="#icon-close"/></svg>
                </button>
            </div>
        </header>

        <!-- Tab 切换 -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="rules">
                <svg width="16" height="16"><use href="#icon-doc"/></svg>
                <span>规则</span>
            </button>
            <button class="tab-btn" data-tab="folders">
                <svg width="16" height="16"><use href="#icon-folder"/></svg>
                <span>文件夹</span>
            </button>
            <button class="tab-btn tab-icon-only" data-tab="logs" title="日志">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14 2 14 8 20 8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                    <polyline points="10 9 9 9 8 9"/>
                </svg>
            </button>
            <button class="tab-btn tab-icon-only" data-tab="settings" title="设置">
                <svg width="16" height="16"><use href="#icon-settings"/></svg>
                <span>设置</span>
            </button>
        </nav>

        <!-- Tab 内容区域 -->
        <main class="tab-content">
            
            <!-- 规则 Tab -->
            <section class="tab-pane active" id="rules-pane">
                <div class="pane-header">
                    <h2>整理规则</h2>
                    <button class="btn-primary" id="addRuleBtn">
                        + 添加规则
                    </button>
                </div>
                <div class="rules-list" id="rulesList">
                    <div class="empty-state">
                        <svg class="empty-icon" width="48" height="48"><use href="#icon-doc"/></svg>
                        <p>暂无规则</p>
                        <p class="empty-hint">创建规则来自动整理文件</p>
                    </div>
                </div>
            </section>

            <!-- 文件夹 Tab -->
            <section class="tab-pane" id="folders-pane">
                <div class="pane-header">
                    <h2>监控文件夹</h2>
                    <button class="btn-primary" id="addFolderBtn">
                        + 添加文件夹
                    </button>
                </div>
                <div class="folder-list" id="folderList">
                    <div class="empty-state">
                        <svg class="empty-icon" width="48" height="48"><use href="#icon-folder"/></svg>
                        <p>暂无监控文件夹</p>
                        <p class="empty-hint">点击上方按钮添加文件夹开始监控</p>
                    </div>
                </div>
            </section>

            <!-- 日志 Tab -->
            <section class="tab-pane" id="logs-pane">
                <div class="pane-header">
                    <h2>活动日志</h2>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn-secondary" id="clearActivityBtn">
                            🗑️ 清空日志
                        </button>
                        <button class="btn-secondary" id="clearProcessedBtn" title="清除已处理文件记录，允许重新整理之前处理过的文件">
                            🔄 清除记录
                        </button>
                    </div>
                </div>
                <div class="activity-log" id="activityLog">
                    <div class="activity-item">
                        <span class="activity-time">启动</span>
                        <span class="activity-message">FloatSort V2 已就绪</span>
                    </div>
                </div>
            </section>

            <!-- 设置 Tab -->
            <section class="tab-pane" id="settings-pane">
                <div class="pane-header">
                    <h2>应用设置</h2>
                </div>
                
                <div class="settings-section">
                    <h3>窗口动画</h3>
                    <p class="section-desc">设置窗口展开/折叠时的动画效果</p>
                    
                    <div class="setting-item">
                        <label class="setting-label" for="animationSelect">动画效果</label>
                        <select id="animationSelect" class="setting-select">
                            <option value="none">无动画（直接显示）</option>
                            <option value="fade">淡入淡出</option>
                            <option value="slide">滑动展开</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <label class="setting-label" for="animationSpeedSelect">动画速度</label>
                        <select id="animationSpeedSelect" class="setting-select">
                            <option value="fast">快速（150ms）</option>
                            <option value="normal">正常（300ms）</option>
                            <option value="slow">慢速（500ms）</option>
                        </select>
                    </div>
                </div>
                
                <div class="settings-section">
                    <h3>统计信息</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="filesProcessedCount">0</div>
                            <div class="stat-label">已处理文件</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="foldersCount">0</div>
                            <div class="stat-label">监控文件夹</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="rulesCount">0</div>
                            <div class="stat-label">活动规则</div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- 添加文件夹模态框 -->
    <div class="modal" id="folderModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="folderModalTitle">添加文件夹</h2>
                <button class="close-btn" id="closeFolderModal">
                    <svg width="16" height="16"><use href="#icon-close"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="folderForm">
                    <div class="form-group">
                        <label for="folderPath">文件夹路径 <span class="required">*</span></label>
                        <div class="input-group">
                            <input type="text" id="folderPath" readonly required>
                            <button type="button" class="btn-secondary" id="browseFolderBtn">浏览</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="folderName">文件夹名称 <span class="required">*</span></label>
                        <input type="text" id="folderName" placeholder="例如：桌面下载" required>
                    </div>
                    <div class="form-group">
                        <label>关联规则</label>
                        <div class="checkbox-group" id="folderRules">
                            <p class="hint">加载中...</p>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="folderEnabled" checked>
                            <span>立即启用监控</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelFolderBtn">取消</button>
                <button class="btn-primary" id="saveFolderBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- 添加/编辑规则模态框 -->
    <div class="modal" id="ruleModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="ruleModalTitle">创建规则</h2>
                <button class="close-btn" id="closeRuleModal">
                    <svg width="16" height="16"><use href="#icon-close"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="ruleForm">
                    <div class="form-group">
                        <label for="ruleName">规则名称 <span class="required">*</span></label>
                        <input type="text" id="ruleName" placeholder="例如：图片文件归类" required>
                    </div>
                    
                    <div class="form-group">
                        <label>应用范围</label>
                        <div class="file-type-checkboxes">
                            <label class="checkbox-label">
                                <input type="checkbox" id="applyToFiles" checked>
                                <span>文件</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="applyToFolders">
                                <span>文件夹</span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>条件设置（同时满足所有条件）</label>
                        <div class="conditions-builder">
                            <div class="condition-selector">
                                <div class="condition-inputs-group">
                                    <select id="conditionType">
                                        <option value="extension">文件扩展名</option>
                                        <option value="name">文件名包含</option>
                                        <option value="regex">正则表达式</option>
                                        <option value="size">文件大小</option>
                                        <option value="created">创建时间</option>
                                        <option value="modified">修改时间</option>
                                    </select>
                                    <div id="conditionInputs" class="condition-inputs">
                                        <!-- 动态生成输入框 -->
                                    </div>
                                </div>
                                <button type="button" class="btn-secondary btn-sm" id="addConditionBtn">➕ 添加条件</button>
                            </div>
                            <div class="conditions-list" id="conditionsList">
                                <!-- 已添加的条件 -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="targetFolder">目标文件夹 <span class="required">*</span> <span class="hint-inline">（支持相对路径和绝对路径）</span></label>
                        <div class="input-with-button">
                            <input type="text" id="targetFolder" placeholder="例如：Pictures/{year}/{month} 或 C:\Documents\Photos" required>
                            <button type="button" class="btn-browse" id="browseTargetFolderBtn" title="选择文件夹">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                                </svg>
                            </button>
                        </div>
                        <p class="hint">相对路径：相对于监控文件夹的子目录名 | 绝对路径：完整的系统路径 | 点击下方占位符可快速插入：</p>
                        <div class="placeholder-tags">
                            <div class="tag-group">
                                <span class="tag-group-label">文件属性:</span>
                                <button type="button" class="tag-btn" data-placeholder="{name}" title="文件名（不含扩展名）">{name}</button>
                                <button type="button" class="tag-btn" data-placeholder="{ext}" title="扩展名">{ext}</button>
                            </div>
                            <div class="tag-group">
                                <span class="tag-group-label">日期时间:</span>
                                <button type="button" class="tag-btn" data-placeholder="{year}" title="年份（4位数字）">{year}</button>
                                <button type="button" class="tag-btn" data-placeholder="{month}" title="月份（2位数字）">{month}</button>
                                <button type="button" class="tag-btn" data-placeholder="{day}" title="日期（2位数字）">{day}</button>
                            </div>
                            <div class="tag-group">
                                <span class="tag-group-label">系统路径:</span>
                                <button type="button" class="tag-btn" data-placeholder="{desktop}" title="桌面目录">{desktop}</button>
                                <button type="button" class="tag-btn" data-placeholder="{documents}" title="文档目录">{documents}</button>
                                <button type="button" class="tag-btn" data-placeholder="{downloads}" title="下载目录">{downloads}</button>
                                <button type="button" class="tag-btn" data-placeholder="{pictures}" title="图片目录">{pictures}</button>
                                <button type="button" class="tag-btn" data-placeholder="{music}" title="音乐目录">{music}</button>
                                <button type="button" class="tag-btn" data-placeholder="{videos}" title="视频目录">{videos}</button>
                            </div>
                            <div class="tag-group">
                                <span class="tag-group-label">特殊操作:</span>
                                <button type="button" class="tag-btn tag-btn-recycle" data-placeholder="{recycle}" title="移动到回收站（文件不会被永久删除）">🗑️ {recycle}</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelRuleBtn">取消</button>
                <button class="btn-primary" id="saveRuleBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- 批量整理确认模态框 -->
    <div class="modal" id="batchConfirmModal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <div>
                    <h2 id="batchModalTitle">批量整理确认</h2>
                    <p style="margin: 5px 0 0 0; font-size: 13px; color: #666;" id="batchModalSubtitle">
                        检测到 <span id="batchCount" style="color: #667eea; font-weight: bold;">0</span> 个文件待整理
                    </p>
                </div>
                <button class="close-btn" id="closeBatchModal">
                    <svg width="16" height="16"><use href="#icon-close"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <!-- 进度条 -->
                <div class="batch-progress" id="batchProgress" style="display: none;">
                    <div class="progress-info">
                        <span id="progressText">正在整理文件...</span>
                        <span id="progressCount">0 / 0</span>
                    </div>
                    <div class="progress-bar-container">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="progress-stats">
                        <span class="stat-success">✓ 成功: <strong id="successCount">0</strong></span>
                        <span class="stat-skip">⊘ 跳过: <strong id="skipCount">0</strong></span>
                        <span class="stat-fail">✗ 失败: <strong id="failCount">0</strong></span>
                    </div>
                </div>
                
                <!-- 文件列表 -->
                <div class="batch-file-list" id="batchFileList">
                    <!-- 文件列表将动态生成 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelBatch">取消</button>
                <button class="btn-primary" id="confirmBatch">确认整理</button>
            </div>
        </div>
    </div>

    <!-- 删除确认模态框 -->
    <div class="modal" id="deleteConfirmModal" style="display: none;">
        <div class="modal-content" style="max-width: 450px;">
            <div class="modal-header">
                <h2 style="color: #e74c3c; display: flex; align-items: center; gap: 10px;">
                    <svg width="24" height="24" viewBox="0 0 16 16" fill="none" style="color: #e74c3c;">
                        <circle cx="8" cy="8" r="7" stroke="currentColor" stroke-width="2" fill="none"/>
                        <path d="M8 4V8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="8" cy="11" r="1" fill="currentColor"/>
                    </svg>
                    删除确认
                </h2>
                <button class="close-btn" id="closeDeleteConfirm">
                    <svg width="16" height="16"><use href="#icon-close"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <p id="deleteConfirmMessage" style="font-size: 14px; line-height: 1.8; color: #333; margin: 0;">
                    <!-- 确认消息将动态生成 -->
                </p>
                <div style="margin-top: 16px; padding: 12px; background: #fff3cd; border-left: 3px solid #ffc107; border-radius: 4px;">
                    <p style="margin: 0; font-size: 13px; color: #856404;">
                        ⚠️ <strong>警告：</strong>此操作无法撤销，请谨慎操作！
                    </p>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelDelete">取消</button>
                <button class="btn-primary" id="confirmDelete" style="background: #e74c3c; border-color: #e74c3c;">
                    确认删除
                </button>
            </div>
        </div>
    </div>

    <!-- 右键菜单 -->
    <div class="context-menu" id="contextMenu">
        <!-- 菜单项将动态生成 -->
    </div>

    <!-- 通知容器（已弃用，保留以防兼容性） -->
    <div id="notificationContainer" style="display: none;"></div>

    <!-- 状态栏 -->
    <div class="status-bar" id="statusBar">
        <div class="status-icon" id="statusIcon">ℹ️</div>
        <div class="status-message" id="statusMessage">就绪</div>
    </div>

    <script src="app_v2.js"></script>
</body>
</html>
