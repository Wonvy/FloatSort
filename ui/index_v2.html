<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FloatSort - V2</title>
    <link rel="stylesheet" href="styles_minimal.css">
</head>
<body>
    <!-- SVG图标库 -->
    <svg style="display: none;">
        <symbol id="icon-folder" viewBox="0 0 24 24">
            <path fill="currentColor" d="M10 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/>
        </symbol>
        <symbol id="icon-doc" viewBox="0 0 24 24">
            <path fill="currentColor" d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
        </symbol>
        <symbol id="icon-activity" viewBox="0 0 24 24">
            <path fill="currentColor" d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
        </symbol>
        <symbol id="icon-minimize" viewBox="0 0 24 24">
            <path fill="currentColor" d="M19 13H5v-2h14v2z"/>
        </symbol>
        <symbol id="icon-close" viewBox="0 0 24 24">
            <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
        </symbol>
        <symbol id="icon-check" viewBox="0 0 24 24">
            <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>
        </symbol>
        <symbol id="icon-error" viewBox="0 0 24 24">
            <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/>
        </symbol>
        <symbol id="icon-up" viewBox="0 0 24 24">
            <path fill="currentColor" d="M7 14l5-5 5 5z"/>
        </symbol>
        <symbol id="icon-down" viewBox="0 0 24 24">
            <path fill="currentColor" d="M7 10l5 5 5-5z"/>
        </symbol>
    </svg>
    
    <!-- Mini悬浮窗模式 -->
    <div class="mini-window" id="miniWindow" style="display: none;">
        <div class="mini-content">
            <svg class="mini-icon" width="40" height="40"><use href="#icon-folder"/></svg>
            <div class="mini-text">
                <div class="mini-label" id="miniRuleLabel">[*]</div>
                <div class="mini-name" id="miniRuleName">所有规则</div>
            </div>
            <div class="mini-status" id="miniStatus">滚轮切换</div>
        </div>
    </div>

    <!-- 完整界面 -->
    <div class="app-container" id="appContainer">
        <!-- 自定义拖拽区域 -->
        <div class="drag-region" data-tauri-drag-region></div>
        
        <!-- 顶部标题栏 -->
        <header class="app-header">
            <div class="logo">
                <svg class="logo-icon" width="24" height="24"><use href="#icon-folder"/></svg>
                <h1>FloatSort</h1>
            </div>
            <div class="header-actions">
                <button class="icon-btn" id="minimizeBtn" title="最小化为悬浮窗">
                    <svg width="18" height="18"><use href="#icon-minimize"/></svg>
                </button>
                <button class="icon-btn close-btn" id="closeWindowBtn" title="关闭">
                    <svg width="18" height="18"><use href="#icon-close"/></svg>
                </button>
            </div>
        </header>

        <!-- Tab 切换 -->
        <nav class="tab-nav">
            <button class="tab-btn active" data-tab="rules">
                <svg width="16" height="16"><use href="#icon-doc"/></svg>
                <span>规则</span>
            </button>
            <button class="tab-btn" data-tab="folders">
                <svg width="16" height="16"><use href="#icon-folder"/></svg>
                <span>文件夹</span>
            </button>
            <button class="tab-btn" data-tab="activity">
                <svg width="16" height="16"><use href="#icon-activity"/></svg>
                <span>活动</span>
            </button>
        </nav>

        <!-- Tab 内容区域 -->
        <main class="tab-content">
            
            <!-- 规则 Tab -->
            <section class="tab-pane active" id="rules-pane">
                <div class="pane-header">
                    <h2>整理规则</h2>
                    <button class="btn-primary" id="addRuleBtn">
                        + 添加规则
                    </button>
                </div>
                <div class="rules-list" id="rulesList">
                    <div class="empty-state">
                        <svg class="empty-icon" width="48" height="48"><use href="#icon-doc"/></svg>
                        <p>暂无规则</p>
                        <p class="empty-hint">创建规则来自动整理文件</p>
                    </div>
                </div>
            </section>

            <!-- 文件夹 Tab -->
            <section class="tab-pane" id="folders-pane">
                <div class="pane-header">
                    <h2>监控文件夹</h2>
                    <button class="btn-primary" id="addFolderBtn">
                        + 添加文件夹
                    </button>
                </div>
                <div class="folder-list" id="folderList">
                    <div class="empty-state">
                        <svg class="empty-icon" width="48" height="48"><use href="#icon-folder"/></svg>
                        <p>暂无监控文件夹</p>
                        <p class="empty-hint">点击上方按钮添加文件夹开始监控</p>
                    </div>
                </div>
            </section>

            <!-- 活动 Tab -->
            <section class="tab-pane" id="activity-pane">
                <div class="pane-header">
                    <h2>活动日志</h2>
                    <button class="btn-secondary" id="clearActivityBtn">
                        🗑️ 清空
                    </button>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="filesProcessedCount">0</div>
                        <div class="stat-label">已处理文件</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="foldersCount">0</div>
                        <div class="stat-label">监控文件夹</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="rulesCount">0</div>
                        <div class="stat-label">活动规则</div>
                    </div>
                </div>
                <div class="activity-log" id="activityLog">
                    <div class="activity-item">
                        <span class="activity-time">启动</span>
                        <span class="activity-message">FloatSort V2 已就绪</span>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- 添加文件夹模态框 -->
    <div class="modal" id="folderModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="folderModalTitle">添加文件夹</h2>
                <button class="close-btn" id="closeFolderModal">
                    <svg width="16" height="16"><use href="#icon-close"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="folderForm">
                    <div class="form-group">
                        <label for="folderPath">文件夹路径 <span class="required">*</span></label>
                        <div class="input-group">
                            <input type="text" id="folderPath" readonly required>
                            <button type="button" class="btn-secondary" id="browseFolderBtn">浏览</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="folderName">文件夹名称 <span class="required">*</span></label>
                        <input type="text" id="folderName" placeholder="例如：桌面下载" required>
                    </div>
                    <div class="form-group">
                        <label>关联规则</label>
                        <div class="checkbox-group" id="folderRules">
                            <p class="hint">加载中...</p>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="folderEnabled" checked>
                            <span>立即启用监控</span>
                        </label>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelFolderBtn">取消</button>
                <button class="btn-primary" id="saveFolderBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- 添加/编辑规则模态框 -->
    <div class="modal" id="ruleModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="ruleModalTitle">创建规则</h2>
                <button class="close-btn" id="closeRuleModal">
                    <svg width="16" height="16"><use href="#icon-close"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <form id="ruleForm">
                    <div class="form-group">
                        <label for="ruleName">规则名称 <span class="required">*</span></label>
                        <input type="text" id="ruleName" placeholder="例如：图片文件归类" required>
                    </div>
                    
                    <div class="form-group">
                        <label>条件设置</label>
                        <div class="conditions-builder">
                            <div class="condition-selector">
                                <select id="conditionType">
                                    <option value="extension">文件扩展名</option>
                                    <option value="name">文件名包含</option>
                                    <option value="regex">正则表达式</option>
                                    <option value="size">文件大小</option>
                                    <option value="created">创建时间</option>
                                    <option value="modified">修改时间</option>
                                </select>
                                <div id="conditionInputs" class="condition-inputs">
                                    <!-- 动态生成输入框 -->
                                </div>
                                <button type="button" class="btn-secondary btn-sm" id="addConditionBtn">➕ 添加条件</button>
                            </div>
                            <div class="conditions-list" id="conditionsList">
                                <!-- 已添加的条件 -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="targetFolder">目标文件夹 <span class="required">*</span></label>
                        <input type="text" id="targetFolder" placeholder="例如：Pictures/{year}/{month}" required>
                        <p class="hint">相对于监控文件夹的子目录名<br>
                        支持占位符：<code>{name}</code>=文件名 <code>{ext}</code>=扩展名 <code>{year}</code>=年份 <code>{month}</code>=月份 <code>{day}</code>=日期</p>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelRuleBtn">取消</button>
                <button class="btn-primary" id="saveRuleBtn">保存</button>
            </div>
        </div>
    </div>

    <!-- 批量整理确认模态框 -->
    <div class="modal" id="batchConfirmModal" style="display: none;">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <div>
                    <h2>批量整理确认</h2>
                    <p style="margin: 5px 0 0 0; font-size: 13px; color: #666;">
                        检测到 <span id="batchCount" style="color: #667eea; font-weight: bold;">0</span> 个文件待整理
                    </p>
                </div>
                <button class="close-btn" id="closeBatchModal">
                    <svg width="16" height="16"><use href="#icon-close"/></svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="batch-file-list" id="batchFileList">
                    <!-- 文件列表将动态生成 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary" id="cancelBatch">取消</button>
                <button class="btn-primary" id="confirmBatch">确认整理</button>
            </div>
        </div>
    </div>

    <!-- 右键菜单 -->
    <div class="context-menu" id="contextMenu">
        <!-- 菜单项将动态生成 -->
    </div>

    <!-- 通知容器 -->
    <div id="notificationContainer"></div>

    <script src="app_v2.js"></script>
</body>
</html>

