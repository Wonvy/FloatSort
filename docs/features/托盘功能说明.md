# 系统托盘功能说明

📅 日期：2025-10-28  
✨ 新功能：系统托盘支持

---

## 🎯 **功能描述**

### **点击关闭按钮**
- ❌ **之前**：直接退出程序
- ✅ **现在**：最小化到系统托盘（右下角）

### **托盘交互**
1. **左键点击托盘图标** → 显示窗口
2. **右键点击托盘图标** → 显示菜单
   - 显示窗口
   - 退出程序

---

## 🧪 **测试指南**

### **基础测试**
```
1. 点击窗口的关闭按钮（✕）
   ✓ 窗口消失
   ✓ 任务栏图标消失
   ✓ 系统托盘出现FloatSort图标

2. 左键单击托盘图标
   ✓ 窗口重新显示
   ✓ 窗口获得焦点

3. 右键单击托盘图标
   ✓ 显示菜单：显示窗口 | 退出程序

4. 点击"退出程序"
   ✓ 程序完全退出
   ✓ 托盘图标消失
```

---

## 💻 **实现细节**

### **后端（Rust）**
```rust
// 创建托盘菜单
let show = CustomMenuItem::new("show", "显示窗口");
let quit = CustomMenuItem::new("quit", "退出程序");
let tray_menu = SystemTrayMenu::new()
    .add_item(show)
    .add_native_item(SystemTrayMenuItem::Separator)
    .add_item(quit);

// 处理托盘事件
.on_system_tray_event(|app, event| {
    match event {
        SystemTrayEvent::LeftClick => {
            // 显示窗口
        }
        SystemTrayEvent::MenuItemClick { id } => {
            match id.as_str() {
                "show" => // 显示窗口
                "quit" => // 退出程序
            }
        }
    }
})
```

### **前端（JavaScript）**
```javascript
// 关闭按钮调用
async function closeWindow() {
    await invoke('hide_to_tray');
    addActivity('[托盘] 已最小化到系统托盘');
}
```

---

## 📝 **注意事项**

1. **托盘图标**：目前使用默认图标，后续可添加自定义图标
2. **首次使用**：Windows可能需要在任务栏设置中显示托盘图标
3. **活动日志**：隐藏到托盘时会记录日志

---

## 🎨 **用户体验**

### **场景1：临时隐藏**
```
用户想临时隐藏FloatSort，但不想关闭
→ 点击关闭按钮
→ 窗口隐藏到托盘
→ 需要时点击托盘图标恢复
```

### **场景2：后台运行**
```
用户希望FloatSort在后台持续监控
→ 隐藏到托盘
→ 继续监控文件夹
→ 处理完成后查看活动日志
```

### **场景3：完全退出**
```
用户想完全退出程序
→ 右键托盘图标
→ 点击"退出程序"
→ 程序完全关闭
```

---

**应用正在编译中，稍后可测试托盘功能！** 🚀

