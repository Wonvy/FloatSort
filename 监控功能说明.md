# 📊 FloatSort 监控功能说明

## 功能概述

**"开始监控"** 是 FloatSort 的核心功能之一，它能够**实时监控指定文件夹**，当检测到新文件时，自动根据配置的规则进行分类整理。

---

## 工作原理

### 1. 监控流程
```
用户点击"开始监控"
    ↓
选择要监控的文件夹（如：下载文件夹、桌面）
    ↓
应用开始实时监控该文件夹
    ↓
检测到新文件创建/移动到该文件夹
    ↓
自动应用已配置的规则
    ↓
文件被自动移动到对应的目标文件夹
    ↓
在活动日志中显示整理记录
```

### 2. 技术实现
- 使用 `notify` crate 实现跨平台文件系统监控
- 异步事件处理，不阻塞主线程
- 支持递归监控（包含子文件夹）
- 实时反馈到前端界面

---

## 使用场景

### 📥 场景 1：自动整理下载文件夹
**问题**：下载的文件散乱堆积在下载文件夹中，难以查找

**解决方案**：
1. 创建规则：
   - 图片文件 (jpg, png, gif) → `下载/图片` 文件夹
   - 文档文件 (pdf, doc, txt) → `下载/文档` 文件夹
   - 压缩文件 (zip, rar) → `下载/压缩包` 文件夹
2. 点击"开始监控"，选择"下载"文件夹
3. 之后所有下载的文件会自动分类到对应文件夹

### 💾 场景 2：桌面自动清理
**问题**：桌面文件越来越多，影响工作效率

**解决方案**：
1. 创建规则：
   - 图片 → `桌面/图片` 文件夹
   - 文档 → `桌面/文档` 文件夹
   - 截图文件（名称包含"截图"）→ `桌面/截图` 文件夹
2. 监控桌面文件夹
3. 新保存到桌面的文件自动归类

### 📧 场景 3：工作文件自动归档
**问题**：项目文件需要按日期或类型分类存档

**解决方案**：
1. 创建规则：
   - 按文件类型分类
   - 按文件大小分类（大文件单独存放）
   - 按修改时间分类
2. 监控工作文件夹
3. 文件自动按规则归档

---

## 使用步骤

### 第一步：创建分类规则
1. 点击 **"➕ 添加规则"** 按钮
2. 填写规则信息：
   - **规则名称**：如"图片归类"
   - **匹配类型**：选择"文件扩展名"、"文件大小"或"文件名包含"
   - **匹配值**：如 `jpg, png, gif`
   - **目标文件夹**：选择文件要移动到的位置
3. 点击"保存规则"

> 💡 **提示**：可以创建多个规则，系统会按优先级自动应用

### 第二步：启动监控
1. 点击 **"👁️ 开始监控"** 按钮
2. 在弹出的文件选择器中，选择要监控的文件夹
   - 常见选择：
     - Windows: `C:\Users\你的用户名\Downloads`（下载文件夹）
     - Windows: `C:\Users\你的用户名\Desktop`（桌面）
     - 或任何自定义文件夹
3. 点击"选择文件夹"

### 第三步：自动整理
- 监控启动后，按钮会变为 **"⏸️ 停止监控"**
- 状态栏显示"监控中"
- 当有新文件进入监控文件夹时：
  - 应用会自动检查所有规则
  - 如果文件匹配某个规则，自动移动到目标位置
  - 在"活动"区域显示整理记录
  - 右上角弹出通知

### 第四步：停止监控
- 点击 **"⏸️ 停止监控"** 按钮即可停止

---

## 功能特点

### ✅ 优势
1. **实时响应**：文件创建后立即检测并处理
2. **自动化**：无需手动操作，规则设置一次，长期有效
3. **可配置**：支持多种匹配条件和动作
4. **可视化反馈**：所有操作都有日志记录
5. **资源占用低**：使用操作系统原生 API，性能优秀

### ⚙️ 支持的匹配条件
- **文件扩展名**：如 jpg, png, pdf, doc
- **文件大小**：如大于 10MB 的文件
- **文件名包含**：如包含"截图"、"报告"等关键字
- **创建时间**（待实现）
- **修改时间**（待实现）
- **正则表达式**（待实现）

### 🎯 支持的动作
- **移动文件**：将文件移动到目标文件夹
- **复制文件**（待实现）
- **重命名文件**（待实现）
- **删除文件**（待实现）

---

## 注意事项

### ⚠️ 重要提示
1. **备份重要文件**：在监控重要文件夹前，建议先备份
2. **测试规则**：建议先用测试文件夹验证规则是否正确
3. **避免冲突**：
   - 不要将目标文件夹设置在监控文件夹内（会导致循环移动）
   - 多个规则匹配同一文件时，应用优先级高的规则
4. **性能考虑**：
   - 监控大型文件夹（如整个硬盘）会影响性能
   - 建议只监控特定的工作文件夹
5. **文件占用**：
   - 如果文件正在被其他程序使用，移动可能失败
   - 失败的操作会在活动日志中显示

---

## 示例配置

### 示例 1：下载文件夹智能分类
```
监控路径：C:\Users\YourName\Downloads

规则 1：
  名称：图片归类
  条件：扩展名 = jpg, png, gif, bmp, svg
  动作：移动到 → C:\Users\YourName\Downloads\Images

规则 2：
  名称：文档归类
  条件：扩展名 = pdf, doc, docx, txt, md
  动作：移动到 → C:\Users\YourName\Downloads\Documents

规则 3：
  名称：压缩包归类
  条件：扩展名 = zip, rar, 7z
  动作：移动到 → C:\Users\YourName\Downloads\Archives

规则 4：
  名称：大文件隔离
  条件：文件大小 > 100MB
  动作：移动到 → C:\Users\YourName\Downloads\LargeFiles
```

### 示例 2：工作项目文件归档
```
监控路径：D:\Projects\CurrentWork

规则 1：
  名称：源代码
  条件：扩展名 = js, ts, py, rs, java
  动作：移动到 → D:\Projects\CurrentWork\src

规则 2：
  名称：设计文件
  条件：扩展名 = psd, ai, sketch, figma
  动作：移动到 → D:\Projects\CurrentWork\design

规则 3：
  名称：文档资料
  条件：扩展名 = pdf, md, txt
  动作：移动到 → D:\Projects\CurrentWork\docs
```

---

## 故障排除

### 问题 1：点击"开始监控"后无反应
**原因**：可能没有创建任何规则
**解决**：先创建至少一个规则，然后再启动监控

### 问题 2：文件没有被自动整理
**检查**：
1. 规则是否匹配文件（检查扩展名、大小等）
2. 目标文件夹是否存在且有写入权限
3. 查看活动日志是否有错误信息

### 问题 3：提示"启动监控失败"
**可能原因**：
1. 选择的文件夹不存在
2. 没有文件夹访问权限
3. 文件夹路径包含特殊字符

### 问题 4：监控启动后应用卡顿
**解决**：
1. 检查是否监控了过大的文件夹（如整个C盘）
2. 减少监控路径数量
3. 简化规则复杂度

---

## 技术细节（开发者）

### 核心组件
- **后端**：`src-tauri/src/file_monitor.rs`
- **配置**：`src-tauri/src/config.rs`
- **规则引擎**：`src-tauri/src/rule_engine.rs`
- **文件操作**：`src-tauri/src/file_ops.rs`

### 事件流
1. `notify` crate 监听文件系统事件
2. 检测到 `Create` 或 `Modify` 事件
3. 获取文件信息（大小、扩展名等）
4. 应用规则引擎匹配
5. 执行对应动作（移动、复制等）
6. 通过 Tauri Event 系统通知前端
7. 前端更新 UI 和活动日志

### 配置文件位置
- Windows: `data/config.json`
- 包含：监控路径列表、规则列表、应用设置

---

## 未来计划

### 即将支持的功能
- [ ] 支持多个监控路径同时监控
- [ ] 支持更多匹配条件（正则表达式、创建时间等）
- [ ] 支持更多动作（复制、重命名、删除）
- [ ] 支持规则优先级调整
- [ ] 支持监控统计图表
- [ ] 支持自动启动监控
- [ ] 支持监控日志导出

---

## 总结

**"开始监控"** 功能让 FloatSort 从一个手动工具升级为**智能文件管理助手**。设置好规则后，你可以：
- ✅ 告别手动整理文件的繁琐
- ✅ 保持文件夹永远整洁有序
- ✅ 提高工作效率，专注于重要任务
- ✅ 自定义自己的文件管理流程

**现在就试试吧！** 🚀

