# FloatSort V2 开发进度跟踪

## ✅ Phase 1: 规则编辑功能（已完成）

- ✅ 后端 `update_rule` 命令
- ✅ 后端 `remove_rule` 改用 ID
- ✅ 前端编辑按钮和逻辑
- ✅ 表单双模式支持
- ✅ 测试通过

---

## 🚧 Phase 2: 数据模型重构（进行中 50%）

### **已完成：**

#### 1. 配置结构更新 ✅
**文件：** `src-tauri/src/config.rs`

**新增结构：**
```rust
pub struct WatchFolder {
    pub id: String,
    pub path: String,
    pub name: String,
    pub enabled: bool,
    pub rule_ids: Vec<String>,
}

pub struct AppConfig {
    pub version: u32,  // 配置版本号
    pub folders: Vec<WatchFolder>,  // 文件夹列表
    pub rules: Vec<Rule>,  // 规则库
    // ... 其他字段
}
```

#### 2. 配置迁移功能 ✅
**功能：** 自动将 V1 配置升级到 V2
- ✅ 检测配置版本
- ✅ 自动迁移 `watch_paths` → `folders`
- ✅ 保留所有规则
- ✅ 自动保存新配置

---

### **待完成：**

#### 3. 文件夹管理命令 ⏳
**文件：** `src-tauri/src/main.rs`

**需要添加的命令：**
- [ ] `get_folders()` - 获取所有文件夹
- [ ] `add_folder(folder)` - 添加文件夹
- [ ] `update_folder(id, folder)` - 更新文件夹
- [ ] `remove_folder(id)` - 删除文件夹
- [ ] `toggle_folder(id)` - 切换监控开关
- [ ] `update_folder_rules(id, rule_ids)` - 更新文件夹关联规则

**工作量：** 约 1 小时

---

#### 4. 监控逻辑重构 ⏳
**文件：** `src-tauri/src/file_monitor.rs`

**需要修改：**
- [ ] 支持多文件夹同时监控
- [ ] 每个文件夹使用独立规则集
- [ ] 文件夹独立开关控制
- [ ] 监控状态管理

**工作量：** 约 2 小时

---

#### 5. 更新现有命令 ⏳
**文件：** `src-tauri/src/main.rs`

**需要修改的命令：**
- [ ] `start_monitoring` - 改为基于文件夹 ID
- [ ] `stop_monitoring` - 支持停止特定文件夹
- [ ] `get_statistics` - 返回每个文件夹的统计

**工作量：** 约 30 分钟

---

## ⏳ Phase 3: UI 完全重构（待开始）

### **需要实现：**

#### 1. Tab 切换布局 ⏳
**文件：** `ui/index.html`, `ui/styles.css`

**功能：**
- [ ] Tab 切换组件
- [ ] 文件夹 Tab 视图
- [ ] 规则 Tab 视图
- [ ] 响应式布局

**工作量：** 约 2 小时

---

#### 2. 文件夹管理界面 ⏳
**文件：** `ui/index.html`, `ui/app.js`, `ui/styles.css`

**功能：**
- [ ] 文件夹列表显示
- [ ] 文件夹卡片设计
- [ ] 添加文件夹按钮
- [ ] 编辑文件夹弹窗
- [ ] 监控开关按钮
- [ ] 规则关联选择器

**工作量：** 约 3 小时

---

#### 3. 规则管理界面优化 ⏳
**文件：** `ui/index.html`, `ui/app.js`, `ui/styles.css`

**功能：**
- [ ] 规则 Tab 视图
- [ ] 规则卡片重新设计
- [ ] 显示被引用的文件夹数量
- [ ] 规则使用情况统计

**工作量：** 约 1 小时

---

#### 4. 移除旧 UI 元素 ⏳
**需要移除：**
- [ ] 首页的"开始监控"按钮
- [ ] 拖拽区域（移到文件夹 Tab）
- [ ] 旧的统计显示

**工作量：** 约 30 分钟

---

## ⏳ Phase 4: 监控逻辑优化（待开始）

### **需要实现：**

#### 1. 多文件夹监控管理 ⏳
- [ ] 同时监控多个文件夹
- [ ] 独立的监控线程/任务
- [ ] 文件夹状态同步

#### 2. 规则应用逻辑 ⏳
- [ ] 按文件夹过滤规则
- [ ] 规则优先级处理
- [ ] 规则冲突检测

#### 3. 统计信息 ⏳
- [ ] 每个文件夹独立统计
- [ ] 每个规则独立统计
- [ ] 全局统计汇总

**工作量：** 约 2-3 小时

---

## 📊 总体进度

### **完成情况：**
```
Phase 1: ████████████████████ 100% (已完成)
Phase 2: ██████████░░░░░░░░░░  50% (进行中)
Phase 3: ░░░░░░░░░░░░░░░░░░░░   0% (未开始)
Phase 4: ░░░░░░░░░░░░░░░░░░░░   0% (未开始)

总体进度: ████░░░░░░░░░░░░░░░░  20%
```

### **预计剩余时间：**
- Phase 2 剩余：3-4 小时
- Phase 3：6-7 小时
- Phase 4：2-3 小时
- **总计：11-14 小时**

---

## 🎯 当前任务

### **正在做：**
1. ✅ 更新配置结构
2. ✅ 实现配置迁移
3. ⏳ 添加文件夹管理命令（下一步）

### **下一步计划：**
1. 完成文件夹管理命令
2. 重构监控逻辑
3. 更新现有命令
4. 开始 UI 重构

---

## 💡 决策点

### **当前可以决定：**

#### Option A: 继续完成 Phase 2（推荐）⭐
**内容：** 完成所有后端改动
**时间：** 3-4 小时
**优势：** 完成数据层，为 UI 打好基础

#### Option B: 暂停，先测试现有功能
**内容：** 测试配置迁移是否正常
**时间：** 10 分钟
**优势：** 确保不破坏现有功能

#### Option C: 跳到 Phase 3，先做 UI
**内容：** 直接开始 UI 重构
**劣势：** 后端不完整，UI 无法完全工作

---

## 📝 开发日志

### 2025-10-28 17:10
- ✅ 开始 Phase 2
- ✅ 添加 `WatchFolder` 结构
- ✅ 更新 `AppConfig` 结构
- ✅ 实现配置迁移功能
- ⏳ 准备添加文件夹管理命令

---

## 🔄 下一步建议

### 建议 1：继续完成 Phase 2（推荐）⭐⭐⭐
**理由：**
- 数据层是基础，必须先完成
- 避免后续返工
- 可以逐步测试

**行动：**
1. 添加文件夹管理命令（1 小时）
2. 重构监控逻辑（2 小时）
3. 测试后端功能（30 分钟）
4. 开始 UI 重构

### 建议 2：分批次实施
**理由：**
- 每个批次可以测试
- 降低风险

**行动：**
- 今天：完成 Phase 2 后端
- 明天：Phase 3 UI 重构
- 后天：Phase 4 优化和测试

---

**请告诉我是否继续 Phase 2，还是需要暂停测试？** 🚀

