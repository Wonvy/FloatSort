# 调度功能测试指南

## 📋 测试概览

FloatSort 现在支持4种文件夹执行模式：
- 🚀 **立即执行** (Immediate) - 检测到文件立即整理
- ✋ **手动确认** (Manual) - 检测到文件后需手动确认
- 🔄 **启动时执行** (OnStartup) - 应用启动时自动扫描整理
- ⏱️ **定时执行** (Scheduled) - 按照设定的时间表执行

## 🧪 测试步骤

### 1️⃣ 测试"立即执行"模式

**功能**：检测到文件后立即自动整理

**测试步骤**：
1. 创建一个测试文件夹（如 `D:\测试\立即执行`）
2. 创建一个规则（如：所有 `.txt` 文件移动到 `D:\测试\立即执行\文本文件`）
3. 添加监控文件夹，选择"立即执行"模式
4. 关联刚创建的规则
5. 保存并启动监控
6. 向监控文件夹中添加一个 `.txt` 文件
7. **预期结果**：文件立即被移动到目标文件夹，无需手动确认

**日志检查**：
```
✓ 文件已稳定: "D:\测试\立即执行\test.txt"
✓ 文件检测事件已发送到前端
📋 [自动处理] 开始处理文件
✓ 文件已整理: test.txt
```

---

### 2️⃣ 测试"手动确认"模式

**功能**：检测到文件后添加到待处理列表，需要用户手动点击确认

**测试步骤**：
1. 创建测试文件夹（如 `D:\测试\手动确认`）
2. 创建规则
3. 添加监控文件夹，选择"手动确认"模式
4. 保存并启动监控
5. 向监控文件夹中添加文件
6. **预期结果**：
   - 文件不会立即移动
   - 监控列表的"待处理"计数增加
   - 点击待处理计数，弹出批量确认对话框
   - 点击"确认整理"后文件才被移动

**日志检查**：
```
✓ 文件已稳定: "D:\测试\手动确认\test.txt"
✓ 文件检测事件已发送到前端
```

---

### 3️⃣ 测试"启动时执行"模式

**功能**：应用启动时自动扫描文件夹并整理文件

**测试步骤**：
1. 创建测试文件夹（如 `D:\测试\启动时执行`）
2. 创建规则
3. 添加监控文件夹，选择"启动时执行"模式
4. 保存配置
5. **在监控文件夹中放置一些测试文件**（重要：文件监控器不会检测到这些文件，因为它们不是"新创建"的）
6. 关闭应用
7. 重新启动应用
8. **预期结果**：启动后1秒内，文件夹中的文件被自动扫描和整理

**日志检查**：
```
📅 调度器启动
🔄 发现 1 个需要在启动时执行的文件夹
⏱️ 启动定时任务: <文件夹名>
🔄 启动时执行: <文件夹名> (<路径>)
✅ <文件夹名> 扫描完成，发现 X 个文件
```

---

### 4️⃣ 测试"定时执行 - 间隔模式"

**功能**：每隔固定时间自动扫描整理

**测试步骤**：
1. 创建测试文件夹
2. 创建规则
3. 添加监控文件夹，选择"定时执行"
4. 选择"间隔执行"，设置为"2分钟"（测试用）
5. 保存并启动监控
6. 在监控文件夹中放置测试文件
7. **预期结果**：
   - 首次扫描在启动监控后2分钟执行
   - 之后每隔2分钟执行一次
   - 每次扫描都会整理文件夹中的文件

**日志检查**：
```
⏱️ 发现 1 个需要定时执行的文件夹
⏱️ 启动定时任务: <文件夹名>
⏰ <文件夹名> 将在 2.0 分钟后执行
🚀 执行定时任务: <文件夹名>
✅ <文件夹名> 扫描完成，发现 X 个文件
```

---

### 5️⃣ 测试"定时执行 - 每天模式"

**功能**：每天固定时间执行

**测试步骤**：
1. 创建测试文件夹
2. 创建规则
3. 添加监控文件夹，选择"定时执行"
4. 选择"每天执行"，设置为当前时间后1-2分钟（如当前14:30，设置为14:32）
5. 保存并启动监控
6. 在监控文件夹中放置测试文件
7. **预期结果**：
   - 在设定的时间点执行扫描
   - 如果当天时间已过，将在明天同一时间执行

**日志检查**：
```
⏱️ 发现 1 个需要定时执行的文件夹
⏰ <文件夹名> 将在 X.X 分钟后执行
🚀 执行定时任务: <文件夹名>
```

---

### 6️⃣ 测试"定时执行 - 每周模式"

**功能**：每周固定星期和时间执行

**测试步骤**：
1. 创建测试文件夹
2. 创建规则
3. 添加监控文件夹，选择"定时执行"
4. 选择"每周执行"，选择"今天"的星期，时间设置为当前时间后1-2分钟
5. 保存并启动监控
6. 在监控文件夹中放置测试文件
7. **预期结果**：在设定的时间点执行扫描

**注意**：
- 如果选择的星期和时间已过，将在下周同一时间执行
- 周日对应数字 0，周一对应 1，以此类推

**日志检查**：
```
⏱️ 发现 1 个需要定时执行的文件夹
⏰ <文件夹名> 将在 X.X 分钟后执行
🚀 执行定时任务: <文件夹名>
```

---

## ✅ 测试检查清单

- [ ] 立即执行模式正常工作
- [ ] 手动确认模式正常工作
- [ ] 启动时执行模式正常工作
- [ ] 定时执行 - 间隔模式正常工作
- [ ] 定时执行 - 每天模式正常工作
- [ ] 定时执行 - 每周模式正常工作
- [ ] 监控列表正确显示执行方式
- [ ] 编辑文件夹时正确显示和保存调度设置
- [ ] 日志正确记录调度器活动
- [ ] 多个文件夹可以同时使用不同的调度模式

---

## 🔧 调试技巧

### 查看日志
- 在应用底部点击"活动日志"查看实时日志
- 日志文件位置：`log/floatsort_YYYY-MM-DD.log`

### 常见问题

1. **启动时执行没有反应**
   - 检查文件夹路径是否正确
   - 确保文件夹中有文件
   - 查看日志是否有错误信息

2. **定时任务没有执行**
   - 检查监控是否已启动
   - 查看日志中"将在 X 分钟后执行"的信息
   - 确保应用保持运行（未退出）

3. **文件没有被整理**
   - 检查规则是否正确配置
   - 确认文件夹已关联规则
   - 查看日志中的错误信息

---

## 📊 测试场景建议

### 场景1：下载文件夹自动整理
- **模式**：立即执行
- **适用**：需要实时整理新下载的文件

### 场景2：桌面文件定期清理
- **模式**：定时执行（每天或每周）
- **适用**：不需要实时整理，定期清理即可

### 场景3：项目归档
- **模式**：手动确认
- **适用**：需要人工审核后再整理

### 场景4：工作区初始化
- **模式**：启动时执行
- **适用**：每次启动应用时整理特定文件夹

---

## 🎯 性能测试

对于大量文件的场景，建议测试：
1. 100个文件的扫描速度
2. 1000个文件的扫描速度
3. 多个定时任务同时运行的资源占用

---

## 📝 测试报告模板

```
测试日期：YYYY-MM-DD
测试人员：
应用版本：v0.2.1

| 测试项 | 测试结果 | 备注 |
|--------|---------|------|
| 立即执行 | ✅ 通过 |  |
| 手动确认 | ✅ 通过 |  |
| 启动时执行 | ✅ 通过 |  |
| 定时-间隔 | ✅ 通过 |  |
| 定时-每天 | ✅ 通过 |  |
| 定时-每周 | ✅ 通过 |  |

问题记录：
1. ...
2. ...
```

