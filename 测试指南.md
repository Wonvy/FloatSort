# 📋 FloatSort 测试指南

## 编译完成后请按以下步骤测试

---

### ✅ **测试 1：规则创建功能**

#### 步骤：
1. 点击 **"➕ 添加规则"** 按钮
2. 填写表单：
   - **规则名称**：`测试图片规则`
   - **匹配类型**：选择 `文件扩展名`
   - **匹配值**：输入 `jpg, png, gif`
   - **目标文件夹**：点击"浏览"，选择一个测试文件夹（如 `D:\TestImages`）
3. 点击 **"保存规则"** 按钮

#### 预期结果：
- ✅ 右上角弹出通知："规则 '测试图片规则' 已添加"
- ✅ 活动日志显示："📝 规则已添加: 测试图片规则"
- ✅ 顶部统计的"规则"数量增加

---

### ✅ **测试 2：设置界面（查看规则）**

#### 步骤：
1. 点击 **"⚙️ 设置"** 按钮

#### 预期结果：
- ✅ 弹出设置窗口
- ✅ 显示刚才添加的规则：
  - 规则名称：`测试图片规则`
  - 条件：`扩展名: jpg, png, gif`
  - 目标：显示您选择的文件夹路径
- ✅ 每个规则右侧有"删除"按钮

#### 可选操作：
- 点击"删除"按钮测试删除功能
- 确认后规则应消失

---

### ✅ **测试 3：文件监控功能**（重点）

#### 准备工作：
1. 创建一个测试文件夹（如 `C:\Users\你的用户名\Desktop\测试监控`）
2. 在另一个位置准备几张图片（jpg、png格式）
3. 确保已创建图片分类规则（参考测试1）

#### 测试步骤：

**步骤 1：启动监控**
1. 点击 **"👁️ 开始监控"** 按钮
2. 在弹出的文件夹选择器中，选择刚创建的测试文件夹
3. 点击"选择文件夹"

**预期结果：**
- ✅ 按钮变为 **"⏸️ 停止监控"**
- ✅ 状态栏显示 `监控中`
- ✅ 活动日志显示：`▶️ 监控已启动: C:\Users\...\测试监控`
- ✅ 右上角通知：`监控已启动`

**步骤 2：测试文件检测**
1. 将一张 `.jpg` 图片**复制或移动**到监控文件夹
2. 观察应用界面变化

**预期结果（关键！）：**
- ✅ **后端日志**（命令行窗口）应显示：
  ```
  INFO floatsort::file_monitor: 收到文件事件: Create(...)
  INFO floatsort::file_monitor: 检测到文件创建: "..."
  INFO floatsort::file_monitor: 开始处理文件: "..."
  INFO floatsort::file_ops: 应用规则 '测试图片规则' 到文件 xxx.jpg
  INFO floatsort::file_ops: 文件已移动: "..." -> "..."
  ```
  
- ✅ **前端活动日志**应显示：
  ```
  [时间] 🔍 检测: xxx.jpg
  [时间] ✅ 已整理: xxx.jpg → TestImages/
  ```
  
- ✅ 右上角弹出通知：`已整理: xxx.jpg`

- ✅ **文件应该自动移动**到您指定的目标文件夹

**步骤 3：测试未匹配的文件**
1. 将一个 `.txt` 文件移动到监控文件夹

**预期结果：**
- ✅ 活动日志显示：`○ 未匹配: test.txt`
- ✅ 文件保持在原位置（因为没有匹配的规则）

**步骤 4：停止监控**
1. 点击 **"⏸️ 停止监控"** 按钮

**预期结果：**
- ✅ 按钮变回 **"👁️ 开始监控"**
- ✅ 状态栏显示 `未激活`
- ✅ 活动日志显示：`⏸️ 监控已停止`

---

### ✅ **测试 4：手动拖拽文件**

#### 步骤：
1. 确保监控未启动（如果启动，先停止）
2. 将文件直接**拖拽**到应用窗口的"拖拽区域"
3. 或者点击拖拽区域，在弹出的对话框中选择文件

#### 预期结果：
- ✅ 文件根据规则自动整理
- ✅ 活动日志显示整理记录
- ✅ 统计数字更新

---

## 🐛 常见问题排查

### 问题 1：监控启动但文件没有反应

**检查清单：**
1. ✓ 查看**后端日志**（命令行窗口）是否有 `收到文件事件` 的输出
2. ✓ 确认文件确实是**复制/移动**到监控文件夹（而不是在文件夹内创建）
3. ✓ 检查文件扩展名是否与规则匹配
4. ✓ 确认目标文件夹路径存在且有写入权限

**如果后端日志没有任何输出：**
- 可能是 Windows 文件系统事件问题
- 尝试重启应用
- 查看是否有任何错误日志

### 问题 2：文件移动失败

**可能原因：**
1. 目标文件夹不存在（应用会自动创建）
2. 文件正在被其他程序占用
3. 没有写入权限

**解决方法：**
- 查看活动日志中的错误信息
- 检查后端日志的详细错误

### 问题 3：活动日志没有显示

**检查：**
1. 打开浏览器开发者工具（F12）
2. 查看 Console 选项卡是否有错误
3. 确认事件监听器是否正确设置（应该看到 `设置后端事件监听器...`）

---

## 📊 调试信息

### 查看后端日志
后端日志会在运行 `cargo run` 的命令行窗口中显示：
```
INFO floatsort: FloatSort 启动中...
INFO floatsort::config: 配置已从 "data/config.json" 加载
INFO floatsort: FloatSort 初始化完成
INFO floatsort::file_monitor: 文件监控线程已启动
INFO floatsort::file_monitor: 收到文件事件: Create(...)
```

### 查看前端日志
按 `F12` 打开开发者工具，切换到 Console 选项卡：
```javascript
FloatSort UI 初始化...
✓ invoke: function
Tauri API 已加载
设置后端事件监听器...
✓ 文件已整理: {...}
```

---

## 🎯 完整测试场景

### 场景：整理下载文件夹

**设置：**
1. 创建规则：
   - 图片规则 (jpg, png, gif) → `Downloads/Images`
   - 文档规则 (pdf, doc, txt) → `Downloads/Documents`
   - 压缩包规则 (zip, rar) → `Downloads/Archives`

2. 启动监控：选择 `Downloads` 文件夹

**测试：**
1. 下载一张图片 → 应该自动移动到 `Downloads/Images`
2. 下载一个PDF → 应该自动移动到 `Downloads/Documents`
3. 下载一个ZIP → 应该自动移动到 `Downloads/Archives`

**验证：**
- 每次下载完成后，查看文件是否自动整理
- 活动日志应该实时显示整理过程
- 统计数字应该增加

---

## ✨ 预期的完整工作流程

```
1. 用户添加规则
   ↓
2. 点击"开始监控"，选择文件夹
   ↓
3. 后端日志：文件监控线程已启动
   ↓
4. 用户将文件移动到监控文件夹
   ↓
5. 后端日志：收到文件事件 → 检测到文件创建 → 开始处理文件
   ↓
6. 后端日志：应用规则 → 文件已移动
   ↓
7. 前端活动日志：🔍 检测 → ✅ 已整理
   ↓
8. 前端通知：已整理 xxx.jpg
   ↓
9. 文件成功移动到目标位置
```

---

## 📝 测试报告模板

测试完成后，请反馈以下信息：

**✅ 成功的功能：**
- [ ] 规则创建
- [ ] 设置界面
- [ ] 监控启动
- [ ] 文件检测
- [ ] 文件自动整理
- [ ] 活动日志显示
- [ ] 通知显示

**❌ 失败的功能：**
- 具体描述问题
- 附上后端日志
- 附上前端控制台日志（F12）

**💡 建议改进：**
- 您的任何建议

---

**祝测试顺利！** 🚀

