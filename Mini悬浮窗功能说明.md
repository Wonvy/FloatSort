# FloatSort Mini悬浮窗功能说明

📅 更新日期：2025-10-28  
✨ 版本：V2.4.0

---

## 🎯 **功能概述**

Mini悬浮窗是FloatSort的极简操作模式，将完整界面最小化为一个紧凑的悬浮窗口，保留核心功能的同时最大化桌面空间。

---

## ✨ **核心特性**

### 1. **智能模式切换**

#### **进入Mini模式**
- 点击右上角 `➖` 按钮
- 窗口自动缩小为 300×300 像素
- 显示当前选中的规则

#### **退出Mini模式**
- 单击Mini窗口任意位置
- 窗口自动恢复为 360×520 像素
- 返回完整界面

### 2. **滚轮切换规则** 🎡

在Mini模式下：
- **向上滚动**：切换到上一个规则
- **向下滚动**：切换到下一个规则
- **循环顺序**：
  ```
  [*] 所有规则 ↔ [A] 规则1 ↔ [B] 规则2 ↔ [C] 规则3 ...
  ```

**实时反馈**：
- 规则切换时显示 `规则已切换`
- 1秒后恢复提示 `滚轮切换`

### 3. **右键菜单** 📋

在Mini窗口上右键点击，打开规则选择菜单：

```
┌─────────────────────┐
│ [*] 所有规则      ✓ │
├─────────────────────┤
│ [A] 图片文件归类    │
│ [B] 文档文件归类    │
│ [C] 视频文件归类    │
└─────────────────────┘
```

- 当前选中的规则会高亮显示 `✓`
- 点击任意规则快速切换
- 点击其他地方自动关闭菜单

### 4. **文件拖拽整理** 📁

#### **操作方式**
1. 选择目标规则（滚轮或右键菜单）
2. 拖拽文件到Mini窗口
3. 自动根据当前规则整理文件

#### **视觉反馈**
- **拖拽悬停**：窗口变为纯黑色，白色边框
- **处理中**：显示 `处理中... (N 个)`
- **成功**：显示 `✓ 已整理 N 个`
- **失败**：显示 `✗ 处理失败`
- **未匹配**：显示 `⚠ 未匹配规则`

#### **规则逻辑**

| 选中规则 | 整理行为 |
|---------|---------|
| `[*] 所有规则` | 按优先级匹配第一个符合的规则 |
| `[A] 具体规则` | 仅使用该规则，不匹配则跳过 |

---

## 🎨 **界面设计**

### **Mini模式外观**

```
┌─────────────────┐
│                 │
│       📂        │  ← 灰度图标
│                 │
│      [A]        │  ← 规则标签
│   图片文件归类   │  ← 规则名称
│                 │
│   滚轮切换      │  ← 提示文本
│                 │
└─────────────────┘
```

**配色方案**：
- 背景：黑色半透明 `rgba(0, 0, 0, 0.95)`
- 文字：白色 `#fff`
- 提示：灰色 `#999`
- 图标：灰度滤镜

### **拖拽状态**

```
┌─────────────────┐
│ ┏━━━━━━━━━━━┓ │  ← 白色边框
│ ┃   📂     ┃ │
│ ┃          ┃ │
│ ┃  处理中... ┃ │
│ ┃  (3 个)  ┃ │
│ ┗━━━━━━━━━━━┛ │
└─────────────────┘
```

---

## 🔧 **技术实现**

### **窗口尺寸管理**

```javascript
// 进入Mini模式
await appWindow.setSize(new LogicalSize(300, 300));
await appWindow.setResizable(false);

// 退出Mini模式
await appWindow.setSize(new LogicalSize(360, 520));
await appWindow.setResizable(true);
```

### **规则切换逻辑**

```javascript
// 滚轮事件
window.addEventListener('wheel', (e) => {
    if (e.deltaY < 0) {
        // 向上滚：上一个规则
        currentRuleIndex = Math.max(-1, currentRuleIndex - 1);
    } else {
        // 向下滚：下一个规则
        currentRuleIndex = Math.min(rules.length - 1, currentRuleIndex + 1);
    }
    updateMiniDisplay();
});
```

### **文件处理流程**

```javascript
async function handleMiniFileDrop(files) {
    for (const file of files) {
        // 使用当前选中的规则处理文件
        const result = await invoke('process_file', { path: file });
        
        if (result) {
            successCount++;
        } else {
            // 未匹配规则
        }
    }
    
    // 显示结果反馈
    showStatus(successCount, failCount);
}
```

---

## 📊 **使用场景**

### **场景 1：快速整理桌面**

```
1. 启动FloatSort
2. 点击 ➖ 进入Mini模式
3. 滚轮切换到 [A] 图片归类
4. 拖拽桌面图片到Mini窗口
5. 图片自动移动到Pictures文件夹
```

### **场景 2：分类文件整理**

```
1. Mini模式下右键打开菜单
2. 选择 [B] 文档归类
3. 拖拽文档文件到Mini窗口
4. 文档自动移动到Documents文件夹
```

### **场景 3：批量整理多类型文件**

```
1. 切换到 [*] 所有规则
2. 拖拽各种类型的文件
3. 自动按规则优先级分类
```

### **场景 4：长期后台运行**

```
1. 进入Mini模式
2. 将窗口移到桌面角落
3. 保持悬浮，随时拖拽文件整理
4. 需要设置时单击恢复完整界面
```

---

## 🧪 **测试指南**

### **基础功能测试**

#### 1. 模式切换测试

- [ ] 点击 ➖ 按钮，窗口缩小为Mini模式
- [ ] 单击Mini窗口，恢复完整界面
- [ ] 窗口大小正确（300×300 ↔ 360×520）
- [ ] 界面切换流畅无闪烁

#### 2. 滚轮切换测试

- [ ] 向上滚动，规则索引减1
- [ ] 向下滚动，规则索引加1
- [ ] 在 `[*] 所有规则` 继续向上滚动，不越界
- [ ] 在最后一个规则继续向下滚动，不越界
- [ ] 规则名称和标签正确显示

#### 3. 右键菜单测试

- [ ] 右键点击Mini窗口，菜单正常显示
- [ ] 菜单包含所有规则和"所有规则"选项
- [ ] 当前选中规则显示 `✓` 标记
- [ ] 点击规则，成功切换并关闭菜单
- [ ] 点击菜单外，菜单自动关闭

#### 4. 文件拖拽测试

- [ ] 拖拽单个文件，成功整理
- [ ] 拖拽多个文件，批量整理
- [ ] 拖拽时显示白色边框反馈
- [ ] 处理完成后显示结果提示
- [ ] 2秒后提示文本恢复为"滚轮切换"

### **规则匹配测试**

#### 测试 [*] 所有规则模式

准备文件：
- `test.jpg` (图片)
- `test.docx` (文档)
- `test.txt` (文档)

步骤：
1. 切换到 `[*] 所有规则`
2. 拖拽所有文件到Mini窗口
3. 验证：
   - `test.jpg` → Pictures/
   - `test.docx` → Documents/
   - `test.txt` → Documents/

#### 测试 [A] 具体规则模式

准备文件：
- `photo.jpg` (图片，匹配)
- `report.docx` (文档，不匹配)

步骤：
1. 切换到 `[A] 图片文件归类`
2. 拖拽所有文件到Mini窗口
3. 验证：
   - `photo.jpg` → 已整理
   - `report.docx` → 未匹配（跳过）

### **边界情况测试**

- [ ] 没有规则时，Mini模式显示"无规则"
- [ ] 拖拽不存在的文件路径，显示错误
- [ ] 拖拽文件夹（而非文件），正确处理
- [ ] 网络路径文件，是否支持

---

## 💡 **使用技巧**

### **技巧 1：快捷键组合**

虽然目前没有快捷键，但可以通过以下方式提升效率：
- **多显示器**：将Mini窗口固定在副屏角落
- **触摸板手势**：利用触摸板精确控制滚轮
- **右键快捷**：右键比滚轮更适合精确选择规则

### **技巧 2：规则命名优化**

为了在Mini模式下更易识别，建议：
- ✅ **简洁命名**：`图片归类` 而非 `按扩展名归类图片文件到Pictures文件夹`
- ✅ **使用图标**：`📷 图片` 比纯文字更直观
- ✅ **优先级排序**：常用规则排在前面（A, B, C）

### **技巧 3：工作流集成**

**下载文件自动分类**：
1. 添加"下载"文件夹到监控
2. Mini模式保持在屏幕角落
3. 下载完成后，拖拽到Mini窗口快速分类

**临时文件快速清理**：
1. 切换到 `[D] 临时文件删除` 规则
2. 拖拽不需要的文件到Mini窗口
3. 自动删除（需要配置删除规则）

---

## ⚠️ **注意事项**

### 1. **规则选择逻辑**

- `[*] 所有规则`：按优先级匹配，**只应用第一个匹配的规则**
- `[A] 具体规则`：只匹配该规则，**不匹配则跳过**

**示例**：

假设规则顺序：
- [A] 图片归类 (扩展名: jpg, png)
- [B] 大文件归类 (大小: > 10MB)

拖拽 `photo_20MB.jpg`：
- 在 `[*] 所有规则` 模式：匹配 [A]，移动到Pictures/
- 在 `[B] 大文件归类` 模式：不匹配（因为规则只检查大小，不匹配jpg），跳过

### 2. **窗口置顶**

- Mini窗口自动置顶（`alwaysOnTop: true`）
- 退出Mini模式后恢复正常Z-order

### 3. **性能考虑**

- 拖拽大量文件（>100）时，建议使用完整模式的批量确认功能
- Mini模式适合快速整理少量文件（<20）

---

## 🔄 **与完整模式对比**

| 功能 | Mini模式 | 完整模式 |
|-----|---------|---------|
| **窗口大小** | 300×300 | 360×520 |
| **规则切换** | 滚轮 + 右键菜单 | Tab导航 + 列表 |
| **文件整理** | 拖拽 | 拖拽 + 监控 |
| **批量确认** | ❌ 直接处理 | ✅ >5个文件弹窗确认 |
| **规则管理** | ❌ 不可用 | ✅ 添加/编辑/删除 |
| **文件夹管理** | ❌ 不可用 | ✅ 添加/配置/监控 |
| **统计信息** | ❌ 不可见 | ✅ 实时显示 |
| **活动日志** | ❌ 不可见 | ✅ 详细记录 |
| **适用场景** | 快速临时整理 | 系统配置和监控 |

---

## 🎓 **最佳实践**

### 1. **工作模式切换**

**配置阶段**（完整模式）：
- 添加文件夹
- 配置规则
- 测试监控

**日常使用**（Mini模式）：
- 保持后台运行
- 快速拖拽整理
- 需要时单击恢复配置

### 2. **规则设计**

为Mini模式优化规则：
- 保持规则简洁明了
- 常用规则排前面（优先级高）
- 使用图标或短名称
- 避免过于复杂的条件

### 3. **键鼠配合**

- **滚轮**：在少量规则间快速切换（2-5个）
- **右键菜单**：在大量规则中精确选择（>5个）
- **单击**：快速返回完整界面调整配置

---

## 📈 **未来扩展**

### 计划功能

1. **全局快捷键**
   - `Ctrl+Alt+M`：切换Mini模式
   - `Ctrl+Alt+↑/↓`：切换规则（即使窗口失焦）

2. **Mini窗口自定义**
   - 自定义窗口大小
   - 自定义背景透明度
   - 自定义图标样式

3. **智能记忆**
   - 记住上次选择的规则
   - 记住窗口位置
   - 记住常用规则

4. **批量模式**
   - Mini模式下也支持批量确认
   - 拖拽时长按Shift进入批量模式

---

## 🐛 **已知问题**

1. **窗口拖动**
   - Mini模式下，点击拖动可能会触发退出
   - 解决方案：后续版本添加拖动区域标识

2. **菜单定位**
   - 在屏幕边缘右键，菜单可能超出屏幕
   - 解决方案：检测边界，自动调整菜单位置

---

## 📝 **更新日志**

### V2.4.0 (2025-10-28)
- ✨ 新增Mini悬浮窗模式
- ✨ 滚轮切换规则
- ✨ 右键菜单快速选择
- ✨ Mini模式文件拖拽整理
- 🎨 极简黑白主题
- 🔧 窗口大小自动调整

---

**现在立即测试Mini悬浮窗功能！** 🚀

点击右上角 `➖` 按钮开始体验。

