# FloatSort æ‹–æ‹½åŠŸèƒ½è¯´æ˜

ğŸ“… æ›´æ–°æ—¥æœŸï¼š2025-10-28

---

## âœ… é—®é¢˜ä¿®å¤

### é—®é¢˜
åœ¨ V2 æ¶æ„é‡æ„æ—¶ï¼Œ**æ‹–æ‹½æ–‡ä»¶/æ–‡ä»¶å¤¹åŠŸèƒ½è¢«æ„å¤–ç§»é™¤**ã€‚

### è§£å†³æ–¹æ¡ˆ
å·²é‡æ–°æ·»åŠ å®Œæ•´çš„æ‹–æ‹½æ”¯æŒï¼Œç°åœ¨å¯ä»¥ï¼š
- âœ… æ‹–æ‹½å•ä¸ªæ–‡ä»¶åˆ°çª—å£
- âœ… æ‹–æ‹½å¤šä¸ªæ–‡ä»¶åˆ°çª—å£
- âœ… æ‹–æ‹½æ–‡ä»¶å¤¹åˆ°çª—å£
- âœ… æ”¯æŒæ‰¹é‡ç¡®è®¤ï¼ˆ5ä¸ªåŠä»¥ä¸Šï¼‰

---

## ğŸ¯ æ‹–æ‹½åŠŸèƒ½å·¥ä½œåŸç†

### 1. ç›‘å¬ Tauri æ‹–æ‹½äº‹ä»¶

FloatSort ç›‘å¬ä»¥ä¸‹ä¸‰ä¸ª Tauri ç³»ç»Ÿäº‹ä»¶ï¼š

```javascript
// æ–‡ä»¶æ‹–å…¥çª—å£æ—¶è§¦å‘
listen('tauri://file-drop', event => {
    const files = event.payload;  // æ–‡ä»¶è·¯å¾„æ•°ç»„
    // å¤„ç†æ‹–å…¥çš„æ–‡ä»¶...
});

// æ–‡ä»¶åœ¨çª—å£ä¸Šæ–¹æ‚¬åœæ—¶è§¦å‘ï¼ˆå¯é€‰ï¼‰
listen('tauri://file-drop-hover', event => {
    console.log('æ–‡ä»¶æ‚¬åœ');
});

// æ‹–æ‹½å–æ¶ˆæ—¶è§¦å‘ï¼ˆå¯é€‰ï¼‰
listen('tauri://file-drop-cancelled', () => {
    console.log('æ‹–æ‹½å·²å–æ¶ˆ');
});
```

### 2. æ™ºèƒ½æ‰¹é‡å¤„ç†

æ‹–æ‹½æ–‡ä»¶åçš„å¤„ç†æµç¨‹ï¼š

```
æ‹–å…¥æ–‡ä»¶
  â†“
æ·»åŠ åˆ°æ‰¹é‡é˜Ÿåˆ— (pendingBatch)
  â†“
æ–‡ä»¶æ•°é‡ >= 5ï¼Ÿ
  â”œâ”€ æ˜¯ â†’ æ˜¾ç¤ºæ‰¹é‡ç¡®è®¤çª—å£
  â”‚        ç”¨æˆ·å¯ä»¥æŸ¥çœ‹æ‰€æœ‰æ–‡ä»¶
  â”‚        ç‚¹å‡»"ç¡®è®¤"åæ‰¹é‡å¤„ç†
  â”‚
  â””â”€ å¦ â†’ ç›´æ¥è‡ªåŠ¨å¤„ç†
           é€ä¸ªè°ƒç”¨ process_file
```

### 3. æ–‡ä»¶å¤„ç†é€»è¾‘

```javascript
async function processDraggedFiles(files) {
    for (const filePath of files) {
        // è°ƒç”¨åç«¯å‘½ä»¤å¤„ç†å•ä¸ªæ–‡ä»¶
        const result = await invoke('process_file', { path: filePath });
        
        if (result) {
            // æ•´ç†æˆåŠŸï¼Œæ˜¾ç¤ºè¯¦ç»†è·¯å¾„
            addActivity(`âœ… ${fileName}`, 'success', `ä»: ${filePath}<br>åˆ°: ${result}`);
        } else {
            // æœªåŒ¹é…ä»»ä½•è§„åˆ™
            addActivity(`âš ï¸ æœªåŒ¹é…è§„åˆ™: ${fileName}`);
        }
    }
}
```

---

## ğŸ”§ åç«¯å¤„ç†

### process_file å‘½ä»¤

```rust
#[tauri::command]
async fn process_file(path: String, state: State<'_, AppState>) -> Result<String, String> {
    let config = state.config.lock().map_err(|e| e.to_string())?.clone();
    
    // ä½¿ç”¨æ‰€æœ‰è§„åˆ™å°è¯•æ•´ç†æ–‡ä»¶
    let result = file_ops::organize_single_file(&path, &config.rules)
        .map_err(|e| e.to_string())?;
    
    // æ›´æ–°ç»Ÿè®¡
    let mut stats = state.stats.lock().map_err(|e| e.to_string())?;
    stats.files_processed += 1;
    if !result.is_empty() {
        stats.files_organized += 1;
    }
    
    Ok(result)  // è¿”å›æ–°è·¯å¾„ï¼Œå¦‚æœæœªæ•´ç†åˆ™è¿”å›ç©ºå­—ç¬¦ä¸²
}
```

### è§„åˆ™åŒ¹é…é€»è¾‘

```rust
pub fn organize_single_file(path: &str, rules: &[Rule]) -> Result<String> {
    let file_info = get_file_info(Path::new(path))?;
    let engine = RuleEngine::new(rules.to_vec());
    
    // æŸ¥æ‰¾ç¬¬ä¸€ä¸ªåŒ¹é…çš„è§„åˆ™
    if let Some(rule) = engine.find_matching_rule(&file_info) {
        // åº”ç”¨è§„åˆ™çš„åŠ¨ä½œï¼ˆç§»åŠ¨ã€å¤åˆ¶ã€é‡å‘½åç­‰ï¼‰
        let dest_path = engine.get_destination_path(&rule.action, &file_info, base_path)?;
        
        // æ‰§è¡Œæ–‡ä»¶æ“ä½œ
        move_file(Path::new(path), &PathBuf::from(dest_path))?;
        
        return Ok(dest_path);
    }
    
    Ok(String::new())  // æœªåŒ¹é…ä»»ä½•è§„åˆ™
}
```

---

## ğŸ“‹ ä½¿ç”¨æ–¹æ³•

### æ–¹å¼ 1ï¼šç›´æ¥æ‹–æ‹½ï¼ˆå°‘äº 5 ä¸ªæ–‡ä»¶ï¼‰

1. æ‰“å¼€ FloatSort çª—å£
2. ä»æ–‡ä»¶ç®¡ç†å™¨æ‹–æ‹½æ–‡ä»¶åˆ°çª—å£
3. æ¾å¼€é¼ æ ‡
4. **è‡ªåŠ¨å¤„ç†** - ç«‹å³æ•´ç†æ–‡ä»¶
5. åœ¨"æ´»åŠ¨"Tab æŸ¥çœ‹ç»“æœ

**ç¤ºä¾‹æµç¨‹**ï¼š
```
æ‹–å…¥: report.pdf (3ä¸ªæ–‡ä»¶)
  â†“
ğŸ“¥ æ‹–å…¥ 3 ä¸ªæ–‡ä»¶/æ–‡ä»¶å¤¹
  â†“
ğŸ”„ å¼€å§‹å¤„ç†: report.pdf
  â†“
âœ… report.pdf
ä»: C:\Users\...\Desktop\report.pdf
åˆ°: C:\Users\...\Documents\2025\10\report.pdf
```

---

### æ–¹å¼ 2ï¼šæ‰¹é‡ç¡®è®¤ï¼ˆ5 ä¸ªåŠä»¥ä¸Šæ–‡ä»¶ï¼‰

1. æ‰“å¼€ FloatSort çª—å£
2. ä»æ–‡ä»¶ç®¡ç†å™¨æ‹–æ‹½å¤šä¸ªæ–‡ä»¶ï¼ˆâ‰¥5ä¸ªï¼‰åˆ°çª—å£
3. **æ‰¹é‡ç¡®è®¤çª—å£å¼¹å‡º**
4. æŸ¥çœ‹æ–‡ä»¶åˆ—è¡¨
5. ç‚¹å‡»"ç¡®è®¤æ•´ç†"
6. æ‰¹é‡å¤„ç†æ‰€æœ‰æ–‡ä»¶

**ç¤ºä¾‹æµç¨‹**ï¼š
```
æ‹–å…¥: 10ä¸ªPDFæ–‡ä»¶
  â†“
ğŸ“¥ æ‹–å…¥ 10 ä¸ªæ–‡ä»¶/æ–‡ä»¶å¤¹
  â†“
ğŸ”” æ‰¹é‡æ•´ç†ç¡®è®¤çª—å£å¼¹å‡º
   æ˜¾ç¤ºæ‰€æœ‰10ä¸ªæ–‡ä»¶çš„åˆ—è¡¨
  â†“
ç‚¹å‡»"ç¡®è®¤æ•´ç†"
  â†“
é€ä¸ªå¤„ç†æ‰€æœ‰æ–‡ä»¶
  â†“
æŸ¥çœ‹æ´»åŠ¨æ—¥å¿—ä¸­çš„è¯¦ç»†ç»“æœ
```

---

## ğŸ†š æ‹–æ‹½ vs è‡ªåŠ¨ç›‘æ§

| ç‰¹æ€§ | æ‹–æ‹½æ•´ç† | è‡ªåŠ¨ç›‘æ§ |
|------|---------|---------|
| è§¦å‘æ–¹å¼ | æ‰‹åŠ¨æ‹–æ‹½ | è‡ªåŠ¨æ£€æµ‹ |
| é€‚ç”¨åœºæ™¯ | ä¸´æ—¶æ•´ç†ã€æ‰¹é‡å¤„ç† | æŒç»­ç›‘æ§ã€è‡ªåŠ¨æ•´ç† |
| è§„åˆ™åº”ç”¨ | æ‰€æœ‰å…¨å±€è§„åˆ™ | æ–‡ä»¶å¤¹å…³è”çš„è§„åˆ™ |
| å¤„ç†æ—¶æœº | ç«‹å³å¤„ç† | æ–‡ä»¶å˜åŒ–æ—¶ |
| ç¡®è®¤æœºåˆ¶ | 5ä¸ªä»¥ä¸Šæ‰¹é‡ç¡®è®¤ | 5ä¸ªä»¥ä¸Šæ‰¹é‡ç¡®è®¤ |
| æ´»åŠ¨æ—¥å¿— | æ˜¾ç¤ºè¯¦ç»†è·¯å¾„ | æ˜¾ç¤ºè¯¦ç»†è·¯å¾„ |

---

## ğŸ¯ æœ€ä½³å®è·µ

### åœºæ™¯ 1ï¼šå¿«é€Ÿæ•´ç†æ¡Œé¢æ–‡ä»¶
```
æ“ä½œï¼š
1. é€‰ä¸­æ¡Œé¢ä¸Šçš„æ‰€æœ‰æ‚ä¹±æ–‡ä»¶
2. æ‹–æ‹½åˆ° FloatSort çª—å£
3. ç¡®è®¤æ‰¹é‡æ•´ç†
4. æ–‡ä»¶è‡ªåŠ¨å½’ç±»åˆ°å„ä¸ªæ–‡ä»¶å¤¹

ä¼˜åŠ¿ï¼š
- å¿«é€Ÿæ¸…ç†æ¡Œé¢
- æ— éœ€æ‰‹åŠ¨è®¾ç½®ç›‘æ§
- ä¸€æ¬¡æ€§æ‰¹é‡å¤„ç†
```

### åœºæ™¯ 2ï¼šä¸´æ—¶æ•´ç†ä¸‹è½½æ–‡ä»¶
```
æ“ä½œï¼š
1. æ‰“å¼€ä¸‹è½½æ–‡ä»¶å¤¹
2. é€‰æ‹©éœ€è¦æ•´ç†çš„æ–‡ä»¶
3. æ‹–æ‹½åˆ° FloatSort çª—å£
4. æŸ¥çœ‹æ•´ç†ç»“æœ

ä¼˜åŠ¿ï¼š
- æŒ‰éœ€æ•´ç†
- ä¸å¹²æ‰°å…¶ä»–æ–‡ä»¶
- ç«‹å³æŸ¥çœ‹ç»“æœ
```

### åœºæ™¯ 3ï¼šé…åˆè‡ªåŠ¨ç›‘æ§ä½¿ç”¨
```
è®¾ç½®ï¼š
1. è®¾ç½®æ–‡ä»¶å¤¹è‡ªåŠ¨ç›‘æ§ï¼ˆå¦‚ï¼šä¸‹è½½æ–‡ä»¶å¤¹ï¼‰
2. ä¿æŒ FloatSort è¿è¡Œ

ä¸´æ—¶æ“ä½œï¼š
1. é‡åˆ°å…¶ä»–ä½ç½®çš„æ–‡ä»¶éœ€è¦æ•´ç†
2. æ‹–æ‹½åˆ° FloatSort çª—å£
3. ä½¿ç”¨ç›¸åŒçš„è§„åˆ™è‡ªåŠ¨æ•´ç†

ä¼˜åŠ¿ï¼š
- è‡ªåŠ¨ + æ‰‹åŠ¨ç»“åˆ
- çµæ´»å¤„ç†å„ç§åœºæ™¯
- ç»Ÿä¸€çš„æ•´ç†è§„åˆ™
```

---

## ğŸ› å·²çŸ¥é™åˆ¶

### 1. æ–‡ä»¶å¤¹æ‹–æ‹½
- âš ï¸ æ‹–æ‹½æ–‡ä»¶å¤¹æ—¶ï¼Œåç«¯ä¼šå°è¯•å¤„ç†æ–‡ä»¶å¤¹æœ¬èº«
- âš ï¸ å¦‚æœè§„åˆ™ä¸åŒ¹é…æ–‡ä»¶å¤¹ï¼Œä¼šæ˜¾ç¤º"æœªåŒ¹é…è§„åˆ™"
- ğŸ’¡ **å»ºè®®**ï¼šåªæ‹–æ‹½æ–‡ä»¶ï¼Œä¸è¦æ‹–æ‹½æ–‡ä»¶å¤¹

### 2. è§„åˆ™ä¼˜å…ˆçº§
- âš ï¸ æ‹–æ‹½æ–‡ä»¶ä½¿ç”¨**æ‰€æœ‰å…¨å±€è§„åˆ™**è¿›è¡ŒåŒ¹é…
- âš ï¸ ä¸è€ƒè™‘æ–‡ä»¶å¤¹çš„è§„åˆ™å…³è”å’Œæ’åº
- âš ï¸ è§„åˆ™ä¼˜å…ˆçº§ç”±åç«¯çš„ `priority` å­—æ®µå†³å®š
- ğŸ’¡ **æ”¹è¿›æ–¹å‘**ï¼šæœªæ¥å¯ä»¥æ·»åŠ "æ‹–æ‹½æ—¶é€‰æ‹©æ–‡ä»¶å¤¹"åŠŸèƒ½

### 3. æ‰¹é‡ç¡®è®¤
- âš ï¸ æ‰¹é‡ç¡®è®¤çª—å£ä¸æ˜¾ç¤º"ç›®æ ‡ä½ç½®é¢„è§ˆ"
- âš ï¸ åªåœ¨å¤„ç†åæ‰èƒ½çœ‹åˆ°å®é™…çš„æ•´ç†ç»“æœ
- ğŸ’¡ **æ”¹è¿›æ–¹å‘**ï¼šæ·»åŠ æ•´ç†å‰çš„è·¯å¾„é¢„è§ˆ

---

## ğŸš€ æœªæ¥æ”¹è¿›æ–¹å‘

### çŸ­æœŸæ”¹è¿›
1. **æ‹–æ‹½æ—¶é€‰æ‹©æ–‡ä»¶å¤¹**
   - æ‹–æ‹½æ–‡ä»¶åï¼Œå¼¹å‡ºæ–‡ä»¶å¤¹é€‰æ‹©å™¨
   - é€‰æ‹©è¦åº”ç”¨çš„æ–‡ä»¶å¤¹è§„åˆ™
   - æŒ‰ç…§è¯¥æ–‡ä»¶å¤¹çš„è§„åˆ™æ’åºå’Œä¼˜å…ˆçº§æ•´ç†

2. **æ‰¹é‡é¢„è§ˆ**
   - åœ¨æ‰¹é‡ç¡®è®¤çª—å£ä¸­æ˜¾ç¤ºæ¯ä¸ªæ–‡ä»¶çš„é¢„è®¡ç›®æ ‡ä½ç½®
   - å…è®¸ç”¨æˆ·å•ç‹¬å–æ¶ˆæŸäº›æ–‡ä»¶çš„æ•´ç†

3. **æ‹–æ‹½åŒºåŸŸæç¤º**
   - æ·»åŠ å¯è§†åŒ–çš„æ‹–æ‹½åŒºåŸŸ
   - æ‚¬åœæ—¶é«˜äº®æç¤º
   - æ˜¾ç¤º"æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤å¤„"æ–‡å­—

### ä¸­æœŸæ”¹è¿›
1. **æ‹–æ‹½æ–‡ä»¶å¤¹æ”¯æŒ**
   - é€’å½’å¤„ç†æ–‡ä»¶å¤¹å†…çš„æ‰€æœ‰æ–‡ä»¶
   - ä¿æŒæ–‡ä»¶å¤¹ç»“æ„
   - æ‰¹é‡æ˜¾ç¤ºæ‰€æœ‰å­æ–‡ä»¶

2. **æ™ºèƒ½è§„åˆ™åŒ¹é…**
   - æ ¹æ®æ–‡ä»¶æ¥æºè·¯å¾„è‡ªåŠ¨é€‰æ‹©æ–‡ä»¶å¤¹
   - å­¦ä¹ ç”¨æˆ·çš„æ‹–æ‹½ä¹ æƒ¯
   - æ¨èæœ€åˆé€‚çš„è§„åˆ™

---

## ğŸ“ æŠ€æœ¯ç»†èŠ‚

### å‰ç«¯å®ç°
```javascript
// æ–‡ä»¶: ui/app_v2.js
// è¡Œæ•°: 169-237

// ç›‘å¬æ‹–æ‹½äº‹ä»¶
listen('tauri://file-drop', event => {
    const files = event.payload;
    
    // æ·»åŠ åˆ°æ‰¹é‡é˜Ÿåˆ—
    files.forEach(filePath => {
        appState.pendingBatch.push({
            path: filePath,
            name: fileName
        });
    });
    
    // åˆ¤æ–­æ˜¯å¦éœ€è¦æ‰¹é‡ç¡®è®¤
    if (appState.pendingBatch.length >= appState.batchThreshold) {
        showBatchConfirm();
    } else {
        processDraggedFiles(files);
    }
});

// å¤„ç†æ‹–æ‹½çš„æ–‡ä»¶
async function processDraggedFiles(files) {
    for (const filePath of files) {
        const result = await invoke('process_file', { path: filePath });
        // æ˜¾ç¤ºç»“æœ...
    }
}
```

### åç«¯å®ç°
```rust
// æ–‡ä»¶: src-tauri/src/main.rs
// è¡Œæ•°: 247-264

#[tauri::command]
async fn process_file(path: String, state: State<'_, AppState>) -> Result<String, String> {
    let config = state.config.lock().map_err(|e| e.to_string())?.clone();
    
    // è°ƒç”¨æ–‡ä»¶æ“ä½œæ¨¡å—
    let result = file_ops::organize_single_file(&path, &config.rules)
        .map_err(|e| e.to_string())?;
    
    // æ›´æ–°ç»Ÿè®¡
    let mut stats = state.stats.lock().map_err(|e| e.to_string())?;
    stats.files_processed += 1;
    if !result.is_empty() {
        stats.files_organized += 1;
    }
    
    Ok(result)
}
```

### Tauri é…ç½®
```json
// æ–‡ä»¶: src-tauri/tauri.conf.json
{
  "tauri": {
    "windows": [
      {
        "fileDropEnabled": true  // âœ… å¿…é¡»å¯ç”¨
      }
    ]
  }
}
```

---

## âœ… æµ‹è¯•ç¡®è®¤

### æµ‹è¯•æ­¥éª¤

1. **æµ‹è¯•å•æ–‡ä»¶æ‹–æ‹½**
   ```
   æ“ä½œï¼šæ‹–æ‹½ 1 ä¸ª PDF æ–‡ä»¶
   é¢„æœŸï¼šç«‹å³å¤„ç†ï¼Œæ´»åŠ¨æ—¥å¿—æ˜¾ç¤ºç»“æœ
   ```

2. **æµ‹è¯•å¤šæ–‡ä»¶æ‹–æ‹½ï¼ˆ<5ä¸ªï¼‰**
   ```
   æ“ä½œï¼šæ‹–æ‹½ 3 ä¸ªæ–‡ä»¶
   é¢„æœŸï¼šç«‹å³å¤„ç†ï¼Œæ´»åŠ¨æ—¥å¿—æ˜¾ç¤º 3 æ¡è®°å½•
   ```

3. **æµ‹è¯•æ‰¹é‡æ‹–æ‹½ï¼ˆâ‰¥5ä¸ªï¼‰**
   ```
   æ“ä½œï¼šæ‹–æ‹½ 10 ä¸ªæ–‡ä»¶
   é¢„æœŸï¼šå¼¹å‡ºæ‰¹é‡ç¡®è®¤çª—å£ï¼Œç‚¹å‡»ç¡®è®¤åå¤„ç†
   ```

4. **æµ‹è¯•æœªåŒ¹é…è§„åˆ™**
   ```
   æ“ä½œï¼šæ‹–æ‹½ä¸€ä¸ªä¸åŒ¹é…ä»»ä½•è§„åˆ™çš„æ–‡ä»¶
   é¢„æœŸï¼šæ˜¾ç¤º"âš ï¸ æœªåŒ¹é…è§„åˆ™"
   ```

5. **æµ‹è¯•é”™è¯¯å¤„ç†**
   ```
   æ“ä½œï¼šæ‹–æ‹½ä¸€ä¸ªå·²åˆ é™¤çš„æ–‡ä»¶è·¯å¾„
   é¢„æœŸï¼šæ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
   ```

---

## ğŸ‰ æ€»ç»“

æ‹–æ‹½åŠŸèƒ½å·²å®Œå…¨æ¢å¤å¹¶å¢å¼ºï¼š
- âœ… æ”¯æŒå•ä¸ªå’Œå¤šä¸ªæ–‡ä»¶æ‹–æ‹½
- âœ… æ™ºèƒ½æ‰¹é‡ç¡®è®¤ï¼ˆ5ä¸ªé˜ˆå€¼ï¼‰
- âœ… è¯¦ç»†çš„æ´»åŠ¨æ—¥å¿—
- âœ… ä¸è‡ªåŠ¨ç›‘æ§äº’ä¸å¹²æ‰°
- âœ… ç»Ÿä¸€çš„è§„åˆ™å¼•æ“

ç°åœ¨æ‚¨å¯ä»¥ï¼š
1. æ‰‹åŠ¨æ‹–æ‹½ä¸´æ—¶æ–‡ä»¶å¿«é€Ÿæ•´ç†
2. è®¾ç½®æ–‡ä»¶å¤¹è‡ªåŠ¨ç›‘æ§æŒç»­æ•´ç†
3. ä¸¤ç§æ–¹å¼ç»“åˆä½¿ç”¨ï¼Œçµæ´»åº”å¯¹å„ç§åœºæ™¯

---

**äº«å—æ›´é«˜æ•ˆçš„æ–‡ä»¶ç®¡ç†ä½“éªŒï¼** ğŸš€

